---
layout: post
title:  "Linux vim"
categories: Linux
tags: Linux vim
author: DJY
---

* content
{:toc}
PS：该篇收录自博客网站，挺不错，忘记时可以回顾
# 普通模式（normal）

## 常用操作

| 按键             | 说明                                      |
| ---------------- | ----------------------------------------- |
| i                | 进入 insert 模式，按 ESC 回到 normal 模式 |
| x                | 删除当前光标所在的一个字符                |
| :w [filename]    | 存盘                                      |
| ：q              | 退出                                      |
| :wq              | 存盘 + 退出                               |
| : help [command] | 显示相关命令的帮助                        |

## 各种插入模式

| 按键 | 说明                                     |
| ---- | ---------------------------------------- |
| a    | 在光标后插入                             |
| o    | 在当前行后插入新行                       |
| O    | 在当前行前插入新行                       |
| cw   | 替换从光标坐在位置后到一个单词结尾的字符 |

## 移动光标

| 按键     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| hjkl     | 左下上右                                                     |
| 0        | 数字零，到行首                                               |
| ^        | 到本行第一个不是 blank 字符的位置（blank 字符指空格，tab，换行，回车等） |
| $        | 到本行末尾                                                   |
| g_       | 到本行最后一个不是 blank 字符的位置                          |
| /pattern | 搜索 pattern 字符，在搜索结果中 n 查找下一个，shift + n 表示上一个i嗯 |
| ?pattern | 从结尾处搜索 pattern 字符                                    |
| G        | 移动到最后一行                                               |
| NG       | 移动到第 N 行，如 1G 移动到第一行                            |
| gg       | 移动到第一行                                                 |
| w        | 移动到下一个单词的开头                                       |
| e        | 移动到下一个单词的结尾                                       |
| %        | 匹配括号移动，包括 (/{/[, 使用时需要把光标先移到括号上）     |
| * 和 #   | 匹配光标当前所在的单词，移动光标到下一个（或上一个）匹配单词（*是下一个，#是上一个） |
| fa       | 到下一个为a的字符处，你也可以fs到下一个为s的字符。F 则为 f 的反方向 |
| t,       | 到逗号前的第一个字符。逗号可以变成其它字符。T 则为 t 的反方向 |
| 3fa      | 在当前行查找第三个出现的a。                                  |

### 命令联动（与移动命令）

例如 0y$ 命令意味着：

0 → 先到行头 
y → 从这里开始拷贝 
$ → 拷贝到本行最后一个字符 
你可可以输入 ye，从当前位置拷贝到本单词的最后一个字符。

你也可以输入 y2/foo 来拷贝2个 “foo” 之间的字符串。

## 复制/粘贴

| 按键 | 说明                                     |
| ---- | ---------------------------------------- |
| dd   | 将当前行剪切到剪贴板（常用来删除当前行） |
| p    | 粘贴剪切板                               |
| v    | 可视化选择                               |
| gU   | 变大写                                   |
| gu   | 变小写                                   |

## undo/redo

| 按键   | 说明         |
| ------ | ------------ |
| u      | 撤销操作     |
| ctrl+r | u 的反向操作 |

## 打开/保存/退出/改变文件

| 按键              | 说明                                                         |
| ----------------- | ------------------------------------------------------------ |
| :e [path/to/file] | 打开一个文件                                                 |
| :w                | 存盘                                                         |
| :saveas           | 另存为                                                       |
| :x                | ZZ 或 :wq → 保存并退出 (:x 表示仅在需要时保存，ZZ不需要输入冒号并回车) |
| :q!               | 退出不保存 :qa! 强行退出所有的正在编辑的文件，就算别的文件有更改。 |
| :bn 和 :bp        | 在同时打开多个文件的时候，使用这两个命令来切换下一个或上一个文件。 |

## 重复

| 按键 | 说明                          |
| ---- | ----------------------------- |
| .    | (小数点) 可以重复上一次的命令 |
| N    | 重复某个命令 N 次             |

## 块操作

## 自动补全

insert 模式下，输入一个词的开头后，按 ctrl+p 或 ctrl+n 即可自动补齐

### 其它补齐

Ctrl + X 和 Ctrl + D 宏定义补齐 
Ctrl + X 和 Ctrl + ] 是Tag 补齐 
Ctrl + X 和 Ctrl + F 是文件名 补齐 
Ctrl + X 和 Ctrl + I 也是关键词补齐，但是关键后会有个文件名，告诉你这个关键词在哪个文件中 
Ctrl + X 和 Ctrl +V 是表达式补齐 
Ctrl + X 和 Ctrl +L 这可以对整个行补齐，变态吧。

## 宏录制

qa 操作序列 q, @a, @@

qa 把你的操作记录在寄存器 a。 
于是 @a 会replay被录制的宏。 
@@ 是一个快捷键用来replay最新录制的宏。

### 示例

在一个只有一行且这一行只有“1”的文本中，键入如下命令：

```
qaYp<C-a>q→qa 开始录制Yp 复制行.<C-a> 增加1.q 停止录制.@a → 在1下面写下 2@@ → 在2 正面写下3现在做 100@@ 会创建新的100行，并把数据增加到 103.
```

![图片标题](https://woniuxiang.space/api/file/getImage?fileId=594a3e6022ebf5054c000103)

## 块操作

| 按键   | 说明                               |
| ------ | ---------------------------------- |
| v      | 块选择                             |
| V      | 以行为单位的块选择                 |
| ctrl+v | 垂直选择                           |
| J      | 把所有选择的行连接起来（变成一行） |
| <      | 向左缩进                           |
| >      | 向右缩进                           |
| =      | 自动缩进                           |

### 在所有被选择行的前面添加内容

```
0 ctrl+v [方向键移动] I  [ESC]
```

```
^    -- 到行头ctrl+v    -- 开始可视化的块选择移动光标进行选择I    进入块编辑模式，这时候编辑效果会显示在第一行，其它行是在 ESC 退出后才会显示出来ESC    退出块操作
```

![图片标题](https://woniuxiang.space/api/file/getImage?fileId=594a3b8422ebf5054c000102)

在Windows下的vim，你需要使用 而不是 ， 是拷贝剪贴板。

### 在所有被选择行的后面添加内容

```
ctrl+v    -- 选中相关的行 (可使用 j 或 <C-d> 或是 /pattern 或是 % 等……)$    -- 到行最后A    -- 输入字符串ESC    -- 退出
```

## 分屏/分页浏览

### 分屏

| 按键                  | 说明                     |
| --------------------- | ------------------------ |
| :He                   | 垂直分屏                 |
| :Ve                   | 水平分屏                 |
| ctrl+w+               | 根据方向切换当前所在分屏 |
| ctrl+w_（或 ctrl+w    | ）                       |
| ctrl+w+（或 ctrl+w-） | 增加尺寸                 |

### 分页

| 按键                 | 说明                                        |
| -------------------- | ------------------------------------------- |
| :Te                  | 分页式浏览                                  |
| gt                   | 到下一个页                                  |
| gT                   | 到上一个页                                  |
| [i]gt                | i 是数字，到指定也，比如：5gt 就是到第 5 页 |
| :tabs                | 查看当前打开的窗口和 tab 情况               |
| :tabclose[i]         | 关闭第 i 个 tab                             |
| vim -p file1 file2…. | 直接用 tab 页的方式打开多个文件             |
| :bufdo tab split     | 将 buffer 中的文件全转成 tab                |
| :qa                  | 退出全部分页                                |
| :wqa                 | 保存全部并退出全部                          |

# 编程常用技巧

## 浏览代码

| 按键 | 说明             |
| ---- | ---------------- |
| E:   | 进入文件查看界面 |
| -    | 进入上级目录     |
| D    | 删除文件         |
| R    | 重命名文件       |
| s    | 对文件排序       |
| x    | 执行文件         |
| :cd  | 改变当前目录     |
| :pwd | 查看当前目录     |

## 缓冲区

用:E 浏览打开的文件都没有被关闭，这些文件都在缓冲区中。

| 按键                    | 说明               |
| ----------------------- | ------------------ |
| :ls                     | 查看缓冲区中的文件 |
| :buffer 3               | 切换到第四个文件   |
| :bnext（缩写 :bn）      | 切换到下一个文件   |
| :bprevious （缩写 :bp） | 切换到上一个文件   |
| :blast （缩写 :bl）     | 切换到最后一个文件 |
| :bfirst（缩写 :bf）     | 切换到第一个文件   |

:ls 列出的缓冲区文件列表符号说明： 
– （非活动的缓冲区） 
a （当前被激活缓冲区） 
h （隐藏的缓冲区） 
% （当前的缓冲区） 
\# （交换缓冲区） 
= （只读缓冲区） 
\+ （已经更改的缓冲区）

## 保存回话

| 按键                      | 说明                              |
| ------------------------- | --------------------------------- |
| :mksesion~/.mysession.vim | 保存当前回话状态到 ~/.myssion.vim |

```
vim -S ~/.mysession.vim    -- 恢复会话
```

## 读取Shell命令相关

```
:r!date    -- 插入日期
```

上面这个命令，:r 是:read的缩写，!是表明要运行一个shell命令，意思是我要把shell命令的输出读到vim里来。

## Quickfix

假如我们有一个hello.cpp文件和一个makefile，于是我们可以直接在vim下输入 :make ， 于是就可以make这个hello.cpp文件，如果出错了，我们需要按回车返回，这个时候，我们可以使用下面的命令来把出错显到在vim的分屏中：

```
:cw
```

```
:cp 跳到上一个错误:cn 跳到下一个错误:cl 列出所有错误:cc 显示错误详细信息
```

比如我们正在浏览nginx的代码，这时，我想看看哪里用到了nginx的NGX_HTTP_VAR_INDEXED宏。于是，我可以在vim里输入如下的命令：

```
:grep -r –include=”*.[ch]” NGX_HTTP_VAR_INDEXED src/
```

上面这个命令意思是递归查询src目录下所有的.c和.h文件，其中包括NGX_HTTP_VAR_INDEXED宏。然后，你就会看到vim到shell里去执行并找到了相关的文件，按回车返回vim后，别忘了用 【:cw 】把grep的输出取回来

# 参考

- coolshell 简明 VIM 练级攻略 
  <http://coolshell.cn/articles/5426.html>
- 游戏：VIM大冒险 
  <http://coolshell.cn/articles/7166.html>
- coolshell 无插件VIM编程技巧 
  <http://coolshell.cn/articles/11312.html>